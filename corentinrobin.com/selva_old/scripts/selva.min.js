// Auteur : Corentin ROBIN
// Version : 10 septembre 2020
// Mini-librairie pour créer des applications temps-réel avec mise à jour automatique de l'interface
HTMLElement.prototype._contentType=function()
{if(this.tagName=="INPUT"||this.tagName=="TEXTAREA"||this.tagName=="SELECT")
{if(this.type&&(this.type=="checkbox"||this.type=="radio"))return"checked";else if(this.type&&this.type=="file")return"files";else return"value";}
else if(this.tagName=="IFRAME"||this.tagName=="IMG"||this.tagName=="SCRIPT")return"src";else if(this.tagName=="LINK"||this.tagName=="A")return"href";else return"innerHTML";}
HTMLElement.prototype._setContent=function(content)
{this[this._contentType()]=content;}
HTMLElement.prototype._getContent=function()
{if(this.type&&this.type=="radio")return this.value;else return this[this._contentType()];}
var Selva={attribute:"data-value",fastRendering:true,render:function()
{document.querySelectorAll("input["+Selva.attribute+"][type=radio]").forEach(function(e){e.checked=false});var objects=document.querySelectorAll("["+Selva.attribute+"]"),object,variable,i;for(i=0;i<objects.length;i++)
{object=objects[i];variableName=object.getAttribute(Selva.attribute);if((object.tagName=="INPUT"||object.tagName=="TEXTAREA"||object.tagName=="SELECT")&&object.getAttribute("data-has-listener")!="true")
{object.addEventListener("input",function(event){window[event.target.getAttribute("data-value")]=event.target._getContent()});object.setAttribute("data-has-listener","true");}
try
{variable=eval(variableName);}
catch(error)
{variable=error;}
if(variable.constructor.name=="Array")
{if(variable.length>0)
{if(typeof variable[0].toDOM!="undefined")
{var sourceCode="",j;for(j=0;j<variable.length;j++)sourceCode+=variable[j].toDOM();if(object.innerHTML!=sourceCode)object.innerHTML=sourceCode;}}
else
{object.innerHTML="";}}
else
{if(typeof variable.toDOM!=="undefined")
{var sourceCode=variable.toDOM();if(object.innerHTML!=sourceCode)object.innerHTML=sourceCode;}
else
{if(object.type&&object.type=="radio")
{if(object.value==variable)object.checked=true;else object.checked=false;}
else if(object.type!="file"&&object._getContent()!==variable)object._setContent(variable);}}}
var objects=document.querySelectorAll("[data-style]"),object,style,i;for(i=0;i<objects.length;i++)
{object=objects[i];style=object.getAttribute("data-style");style=style.replace(/\$\{(.*?)\}/g,function(string,match){return window[match]});if(object.style!=style)object.style=style;}
var objects=document.querySelectorAll("[data-class]"),object,_className,i;for(i=0;i<objects.length;i++)
{object=objects[i];_className=object.getAttribute("data-class");if(object.getAttribute("class")!=_className)object.setAttribute("class",window[_className]);}
if(Selva.fastRendering)window.requestAnimationFrame(Selva.render);else window.setTimeout(Selva.render,500);},initialise:function()
{Selva.render();}};window.addEventListener("load",Selva.initialise);